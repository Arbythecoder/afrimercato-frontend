import{j as e}from"./date-iP6_brdS.js";import{u as k,r as o}from"./vendor-CPDP2aPO.js";import{u as S}from"./index-B_A1dkTv.js";import"./ui-Tzc8TJql.js";const P="https://afrimercato-backend.fly.dev";function O(){const i=k(),{isAuthenticated:y}=S(),[c,v]=o.useState([]),[r,n]=o.useState(1),[f,j]=o.useState(!1),[t,d]=o.useState({fullName:"",phone:"",street:"",city:"",postcode:"",instructions:""}),[a,h]=o.useState({method:"card",saveCard:!1});o.useEffect(()=>{const s=JSON.parse(localStorage.getItem("afrimercato_cart")||"[]");v(s),s.length===0&&i("/stores"),y||(localStorage.setItem("checkout_redirect","true"),i("/login"))},[y,i]);const m=c.reduce((s,l)=>s+l.price*l.quantity,0),g=m>=50?0:5,p=m+g,w=s=>{s.preventDefault(),n(2)},C=async s=>{s.preventDefault(),j(!0);try{const l=localStorage.getItem("repeatPurchaseFrequency"),u={items:c.map(x=>({product:x._id,name:x.name,price:x.price,quantity:x.quantity,unit:x.unit||"piece"})),deliveryAddress:t,payment:{method:a.method,status:"pending"},pricing:{subtotal:m,deliveryFee:g,total:p},...l&&{repeatPurchaseFrequency:l}},b=await(await fetch(`${P}/api/checkout/payment/initialize`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("afrimercato_token")}`},body:JSON.stringify(u)})).json();b.success?(localStorage.removeItem("afrimercato_cart"),localStorage.removeItem("repeatPurchaseFrequency"),i(`/order-confirmation/${b.data.order._id}`)):alert("Order failed: "+b.message)}catch(l){console.error("Order error:",l),alert("Failed to place order. Please try again.")}finally{j(!1)}};return c.length===0?null:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white border-b sticky top-0 z-40 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl sm:text-2xl",children:"ðŸ›’"}),e.jsx("span",{className:"text-base sm:text-xl font-bold text-gray-900",children:"Afrimercato Checkout"})]}),e.jsxs("button",{onClick:()=>i(-1),className:"text-gray-600 hover:text-gray-900 min-h-[44px] min-w-[44px] flex items-center justify-center",children:["â¬…ï¸ ",e.jsx("span",{className:"hidden sm:inline ml-1",children:"Back"})]})]})})}),e.jsx("div",{className:"container mx-auto px-3 sm:px-6 py-4 sm:py-8",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4 sm:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"hidden sm:flex items-center justify-between mb-8",children:[e.jsxs("div",{className:`flex items-center ${r>=1?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r>=1?"bg-green-600 text-white":"bg-gray-200"}`,children:r>1?"âœ“":"1"}),e.jsx("span",{className:"ml-2 font-semibold",children:"Delivery"})]}),e.jsx("div",{className:"flex-1 h-1 bg-gray-200 mx-4"}),e.jsxs("div",{className:`flex items-center ${r>=2?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r>=2?"bg-green-600 text-white":"bg-gray-200"}`,children:r>2?"âœ“":"2"}),e.jsx("span",{className:"ml-2 font-semibold",children:"Payment"})]}),e.jsx("div",{className:"flex-1 h-1 bg-gray-200 mx-4"}),e.jsxs("div",{className:`flex items-center ${r>=3?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r>=3?"bg-green-600 text-white":"bg-gray-200"}`,children:"3"}),e.jsx("span",{className:"ml-2 font-semibold",children:"Confirm"})]})]}),r===1&&e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl shadow-md p-4 sm:p-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 mb-4 sm:mb-6",children:"Delivery Address"}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Full Name *"}),e.jsx("input",{type:"text",required:!0,autoComplete:"name",value:t.fullName,onChange:s=>d({...t,fullName:s.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent min-h-[44px]",placeholder:"John Doe"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Phone Number *"}),e.jsx("input",{type:"tel",required:!0,autoComplete:"tel",inputMode:"tel",value:t.phone,onChange:s=>d({...t,phone:s.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent min-h-[44px]",placeholder:"+44 7700 900000"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Street Address *"}),e.jsx("input",{type:"text",required:!0,value:t.street,onChange:s=>d({...t,street:s.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent min-h-[44px]",placeholder:"123 High Street"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"City *"}),e.jsx("input",{type:"text",required:!0,autoComplete:"address-level2",value:t.city,onChange:s=>d({...t,city:s.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent min-h-[44px]",placeholder:"London"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Postcode *"}),e.jsx("input",{type:"text",required:!0,autoComplete:"postal-code",value:t.postcode,onChange:s=>d({...t,postcode:s.target.value.toUpperCase()}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent min-h-[44px]",placeholder:"SW1A 1AA"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Delivery Instructions (Optional)"}),e.jsx("textarea",{value:t.instructions,onChange:s=>d({...t,instructions:s.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent min-h-[44px]",rows:"3",placeholder:"e.g., Leave at door, Ring doorbell, etc."})]}),e.jsx("button",{type:"submit",className:"w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg font-bold text-lg hover:shadow-lg transition min-h-[44px]",children:"Continue to Payment â†’"})]})]}),r===2&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Payment Method"}),e.jsxs("form",{onSubmit:()=>n(3),children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("div",{onClick:()=>h({...a,method:"card"}),className:`border-2 rounded-lg p-4 cursor-pointer transition ${a.method==="card"?"border-green-600 bg-green-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",checked:a.method==="card",onChange:()=>h({...a,method:"card"}),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"ðŸ’³ Card Payment"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pay securely with Paystack"})]})]})}),e.jsx("div",{onClick:()=>h({...a,method:"cash"}),className:`border-2 rounded-lg p-4 cursor-pointer transition ${a.method==="cash"?"border-green-600 bg-green-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",checked:a.method==="cash",onChange:()=>h({...a,method:"cash"}),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"ðŸ’µ Cash on Delivery"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pay when you receive your order"})]})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>n(1),className:"flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition min-h-[44px]",children:"â† Back"}),e.jsx("button",{type:"button",onClick:()=>n(3),className:"flex-1 bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg font-bold hover:shadow-lg transition min-h-[44px]",children:"Review Order â†’"})]})]})]}),r===3&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Review & Confirm"}),e.jsxs("div",{className:"mb-6 pb-6 border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Delivery Address"}),e.jsxs("p",{className:"text-gray-700",children:[t.fullName,e.jsx("br",{}),t.phone,e.jsx("br",{}),t.street,e.jsx("br",{}),t.city,", ",t.postcode]}),t.instructions&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("strong",{children:"Instructions:"})," ",t.instructions]}),e.jsx("button",{onClick:()=>n(1),className:"text-green-600 text-sm font-semibold mt-2 hover:underline",children:"Edit"})]}),e.jsxs("div",{className:"mb-6 pb-6 border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Payment Method"}),e.jsx("p",{className:"text-gray-700",children:a.method==="card"?"ðŸ’³ Card Payment (Paystack)":"ðŸ’µ Cash on Delivery"}),e.jsx("button",{onClick:()=>n(2),className:"text-green-600 text-sm font-semibold mt-2 hover:underline",children:"Edit"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Order Items"}),c.map(s=>e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsxs("span",{className:"text-gray-700",children:[s.name," x ",s.quantity]}),e.jsxs("span",{className:"font-semibold",children:["Â£",(s.price*s.quantity).toFixed(2)]})]},s._id))]}),e.jsx("form",{onSubmit:C,children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>n(2),className:"flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition min-h-[44px]",children:"â† Back"}),e.jsx("button",{type:"submit",disabled:f,className:"flex-1 bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg font-bold hover:shadow-lg transition disabled:opacity-50 min-h-[44px]",children:f?"Placing Order...":`Place Order (Â£${p.toFixed(2)})`})]})})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 sticky top-24",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Order Summary"}),e.jsx("div",{className:"space-y-3 mb-4 max-h-60 overflow-y-auto",children:c.map(s=>{var l,u;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:((u=(l=s.images)==null?void 0:l[0])==null?void 0:u.url)||"https://images.unsplash.com/photo-1542838132-92c53300491e?w=200&q=80",alt:s.name,loading:"lazy",className:"w-16 h-16 object-cover rounded",onError:N=>{N.target.src="https://images.unsplash.com/photo-1542838132-92c53300491e?w=200&q=80"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",s.quantity]}),e.jsxs("p",{className:"text-sm font-bold text-green-600",children:["Â£",s.price.toFixed(2)]})]})]},s._id)})}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["Â£",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsx("span",{children:g===0?"FREE":`Â£${g.toFixed(2)}`})]}),m>=50&&e.jsx("p",{className:"text-xs text-green-600",children:"ðŸŽ‰ Free delivery on orders over Â£50"}),e.jsxs("div",{className:"flex justify-between text-xl font-bold text-gray-900 border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["Â£",p.toFixed(2)]})]})]}),e.jsx("div",{className:"mt-6 bg-green-50 rounded-lg p-3 text-center",children:e.jsx("p",{className:"text-xs text-green-800",children:"ðŸ”’ Secure checkout powered by Paystack"})})]})})]})})]})}export{O as default};
