import{j as r}from"./date-C9mDCBzx.js";import{b as h,f as d,r as m}from"./vendor-BfFvvk5l.js";import{u}from"./index-CfgvYoI6.js";import"./ui-qKdnnCNY.js";function v(){const e=h(),[a]=d(),{setAuth:c}=u();return m.useEffect(()=>{(async()=>{try{const t=a.get("token"),n=a.get("refreshToken"),l=a.get("provider"),s=a.get("error");if(s){console.error("OAuth error:",s),e(`/login?error=${s}`);return}if(!t||!n){console.error("No tokens received from OAuth"),e("/login?error=no_token");return}localStorage.setItem("afrimercato_token",t),localStorage.setItem("afrimercato_refresh_token",n);const i=await fetch("https://afrimercato-backend.fly.dev/api/auth/me",{headers:{Authorization:`Bearer ${t}`}});if(!i.ok)throw new Error("Failed to fetch user data");const o=await i.json();switch(c({user:o.user,token:t,isAuthenticated:!0}),console.log(`âœ… Logged in via ${l}:`,o.user.email),o.user.role||o.user.primaryRole){case"vendor":e("/dashboard");break;case"rider":e("/rider/dashboard");break;case"picker":e("/picker/dashboard");break;case"customer":default:e("/");break}}catch(t){console.error("OAuth callback error:",t),e("/login?error=callback_failed")}})()},[a,e,c]),r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block",children:r.jsxs("svg",{className:"animate-spin h-12 w-12 text-afri-green",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),r.jsx("h2",{className:"mt-6 text-xl font-semibold text-gray-900",children:"Completing sign in..."}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Please wait while we log you in"})]})})}export{v as default};
